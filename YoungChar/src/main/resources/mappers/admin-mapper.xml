<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminMapper">
	<resultMap type="Member" id="member_rm">
		<id property="memberNo" column="MEM_NO"/>
		
   		<result property="memberId" column="MEM_ID"/>
  		<result property="memberPwd" column="MEM_PWD"/>
  		<result property="memberNm" column="MEM_NAME"/>
  		<result property="nickName" column="MEM_NICKNAME"/>
  		<result property="memberEmail" column="MEM_EMAIL"/>
  		<result property="phone" column="MEM_PHONE"/>
  		<result property="memberAddr" column="MEM_ADDRESS"/>
  		<result property="memberGrade" column="MEM_GRADE"/>
  		<result property="memberStatus" column="SIGN_STATUS"/>
  		<result property="signDt" column="SIGN_DT"/>
	</resultMap>
	
	<!-- 신규 회원 수 조회 -->
	<select id="getNewMember" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE SIGN_STATUS = 'N'
		AND SIGN_DT > SYSDATE - 30
	</select>
	
	<!-- 신규 업체 수 조회 -->
	<select id="getNewCompany" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE SIGN_STATUS = 'Y'
		AND MEM_GRADE = 'C'
		AND SIGN_DT > SYSDATE - 30
	</select>
	
	<!-- 전체 게시글 수 조회 -->
	<select id="getAllBoardCount" resultType="_int">
		SELECT COUNT(*) FROM BOARD
		WHERE BOARD_STATUS = 'Y'
	</select>
	
	<!-- 시승예약 건수 조회 -->
	<select id="getTestDrive" resultType="_int">
		SELECT COUNT(*) FROM TES_DR_RESERVATION
		WHERE APPROVAL_STATUS != 'C'
	</select>
	
	<!-- 신규 회원 목록 조회 -->
	<select id="getNewMemList" resultMap="member_rm">
		SELECT * FROM MEMBER
		WHERE SIGN_STATUS = 'N'
		AND ROWNUM &lt; 7
		ORDER BY SIGN_DT DESC
	</select>
	
	<!-- 차트데이터 조회 -->
	<select id="getChartData" resultType="map">
		SELECT CATEGORY_NM DataName, COUNT(*) value
		FROM TES_DR_RESERVATION
			JOIN TEST_DRIVE_CAR USING(TEST_DRIVE_CAR_NO)
			JOIN CAR_INFO USING(CAR_NO)
			JOIN CATEGORY USING(CATEGORY_CD)
		GROUP BY CATEGORY_NM
	</select>
	
	<!-- 가입된 회원 수 조회 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
	</select>
	
	<!-- 전체 회원 목록 조회 -->
	<select id="selectMemberList" resultMap="member_rm">
		SELECT * FROM MEMBER
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 선택회원 탈퇴 기능 -->
	<update id="memberSecession" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'Y'
		WHERE MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 선택회원 복구 기능 -->
	<update id="memberRestore" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'N'
		WHERE MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 회원 검색 결과 페이징 정보 조회 -->
	<select id="getSearchListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEM_ID LIKE '%' || #{sv} || '%'
	</select>
	
	<!-- 회원 검색 결과 조회 -->
	<select id="selectSearchMember" parameterType="string" resultMap="member_rm">
		SELECT * FROM MEMBER
		WHERE MEM_ID LIKE '%' || #{sv} || '%'
		ORDER BY MEM_NO DESC
	</select>
	
</mapper>