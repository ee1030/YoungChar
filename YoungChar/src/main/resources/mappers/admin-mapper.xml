<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminMapper">
	<resultMap type="Member" id="member_rm">
		<id property="memberNo" column="MEM_NO"/>
		
 		<result property="memberId" column="MEM_ID"/>
 		<result property="memberPwd" column="MEM_PWD"/>
 		<result property="memberNm" column="MEM_NAME"/>
 		<result property="nickName" column="MEM_NICKNAME"/>
 		<result property="memberEmail" column="MEM_EMAIL"/>
 		<result property="phone" column="MEM_PHONE"/>
 		<result property="memberAddr" column="MEM_ADDRESS"/>
 		<result property="memberGrade" column="MEM_GRADE"/>
 		<result property="memberStatus" column="SIGN_STATUS"/>
 		<result property="signDt" column="SIGN_DT"/>
 		<result property="cooName" column="COO_NAME"/>
 		<result property="cooNumber" column="COO_NUM"/>
 		<result property="brandCategory" column="CATEGORY_NM"/>
	</resultMap>
	
	<resultMap type="Board" id="board_rm">
	
		<id property="boardNo" column="BOARD_NO"/>
		
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="memberId" column="MEM_ID"/>
		<result property="readCount" column="READ_COUNT"/>
		<result property="categoryName" column="CATEGORY_NM"/>
		<result property="boardCreateDate" column="BOARD_CREATE_DT"/>
		<result property="boardModifyDate" column="BOARD_MODIFY_DT"/>
		<result property="boardStatus" column="BOARD_STATUS"/>
		<result property="boardCode" column="BOARD_CD"/>
		<result property="boardName" column="BOARD_NM"/>
	
	</resultMap>
	
	<!-- 신규 회원 수 조회 -->
	<select id="getNewMember" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE SIGN_STATUS = 'N'
		AND SIGN_DT > SYSDATE - 30
	</select>
	
	<!-- 신규 업체 수 조회 -->
	<select id="getNewCompany" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE SIGN_STATUS = 'Y'
		AND MEM_GRADE = 'C'
		AND SIGN_DT > SYSDATE - 30
	</select>
	
	<!-- 전체 게시글 수 조회 -->
	<select id="getAllBoardCount" resultType="_int">
		SELECT COUNT(*) FROM BOARD
		WHERE BOARD_STATUS = 'Y'
	</select>
	
	<!-- 시승예약 건수 조회 -->
	<select id="getTestDrive" resultType="_int">
		SELECT COUNT(*) FROM TES_DR_RESERVATION
		WHERE APPROVAL_STATUS != 'C'
	</select>
	
	<!-- 신규 회원 목록 조회 -->
	<select id="getNewMemList" resultMap="member_rm">
		SELECT * FROM MEMBER
		WHERE SIGN_STATUS = 'N'
		AND ROWNUM &lt; 7
		ORDER BY SIGN_DT DESC
	</select>
	
	<!-- 차트데이터 조회 -->
	<select id="getChartData" resultType="map">
		SELECT CATEGORY_NM DataName, COUNT(*) value
		FROM TES_DR_RESERVATION
			JOIN TEST_DRIVE_CAR USING(TEST_DRIVE_CAR_NO)
			JOIN CAR_INFO USING(CAR_NO)
			JOIN CATEGORY USING(CATEGORY_CD)
		GROUP BY CATEGORY_NM
	</select>
	
	<!-- 가입된 회원 수 조회 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
	</select>
	
	<!-- 전체 회원 목록 조회 -->
	<select id="selectMemberList" resultMap="member_rm">
		SELECT * FROM MEMBER
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 선택회원 탈퇴 기능 -->
	<update id="memberSecession" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'Y'
		WHERE MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 선택회원 복구 기능 -->
	<update id="memberRestore" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'N'
		WHERE MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 회원 검색 결과 페이징 정보 조회 -->
	<select id="getSearchListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEM_ID LIKE '%' || #{sv} || '%'
	</select>
	
	<!-- 회원 검색 결과 조회 -->
	<select id="selectSearchMember" parameterType="string" resultMap="member_rm">
		SELECT * FROM MEMBER
		WHERE MEM_ID LIKE '%' || #{sv} || '%'
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 신규 업체 승인 갯수 조회 -->
	<select id="getNewCompanyListCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEM_GRADE = 'C'
		AND SIGN_STATUS = 'Y'
	</select>
	
	<!-- 신규 업체 승인 목록 조회 -->
	<select id="selectNewCompanyList" resultMap="member_rm">
		SELECT MEM_NO, COO_NAME, MEM_PHONE, COO_NUM, SIGN_DT, CATEGORY_NM
		FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		JOIN CATEGORY USING (CATEGORY_CD)
		WHERE SIGN_STATUS = 'Y'
	</select>
	
	<!-- 선택 업체 승인 기능 -->
	<update id="newCompanyApproval" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'N'
		WHERE MEM_GRADE = 'C'
		AND MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 신규업체 승인 검색 결과 페이징 정보 조회 -->
	<select id="getSearchNCListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		WHERE COO_NAME LIKE '%' || #{sv} || '%'
		AND MEM_GRADE = 'C'
		AND SIGN_STATUS = 'Y'
	</select>
	
	<!-- 신규업체 승인 검색 목록 조회 -->
	<select id="selectSearchNewCom" parameterType="string" resultMap="member_rm">
		SELECT * FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		WHERE COO_NAME LIKE '%' || #{sv} || '%'
		AND MEM_GRADE = 'C'
		AND SIGN_STATUS = 'Y'
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 모든 업체 갯수 조회 -->
	<select id="getAllCompanyListCount" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		WHERE MEM_GRADE = 'C'
	</select>
	
	<!-- 모든 업체 목록 조회 -->
	<select id="selectAllCompanyList" resultMap="member_rm">
		SELECT MEM_NO, COO_NAME, MEM_PHONE, COO_NUM, SIGN_DT, CATEGORY_NM, SIGN_STATUS
		FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		JOIN CATEGORY USING (CATEGORY_CD)
		WHERE MEM_GRADE = 'C'
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 모든 업체 페이지 승인 기능 -->
	<update id="allCompanyApproval" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'N'
		WHERE MEM_GRADE = 'C'
		AND MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 모든 업체 페이지 승인 취소 기능 -->
	<update id="allCompanyCancellation" parameterType="list">
		UPDATE MEMBER SET
		SIGN_STATUS = 'Y'
		WHERE MEM_GRADE = 'C'
		AND MEM_NO IN 
			<foreach collection="list" item="item" open="(" close=")" separator="," >
				#{item}
			</foreach>
	</update>
	
	<!-- 모든업체 검색 결과 페이징 정보 조회 -->
	<select id="getSearchACListCount" parameterType="string" resultType="_int">
		SELECT COUNT(*) FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		WHERE COO_NAME LIKE '%' || #{sv} || '%'
		AND MEM_GRADE = 'C'
	</select>
	
	<!-- 모든업체 검색 목록 조회 -->
	<select id="selectSearchAllCom" parameterType="string" resultMap="member_rm">
		SELECT * FROM MEMBER
		JOIN COO_MEMBER USING (MEM_NO)
		JOIN CATEGORY USING (CATEGORY_CD)
		WHERE COO_NAME LIKE '%' || #{sv} || '%'
		AND MEM_GRADE = 'C'
		ORDER BY MEM_NO DESC
	</select>
	
	<!-- 전체 게시글 수 조회 -->
	<select id="getAllBoardListCount" resultType="_int">
		SELECT COUNT(*) FROM BOARD
	</select>
	
	<!-- 전체 게시글 목록 조회 -->
	<select id="selectAllBoardList" resultMap="board_rm">
		SELECT * FROM V_BOARD
		ORDER BY BOARD_NO DESC
	</select>
	
</mapper>